<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FontGen AI Studio</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; }
    #preview img { max-width: 400px; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>FontGen AI Studio</h1>
  <input id="prompt" placeholder="Describe your font" size="40" />
  <input id="api_key_input" placeholder="API Key (optional)" size="20" />
  <button id="generate">Generate</button>
  <div id="message"></div>
  <div id="preview"></div>
  <a id="download" style="display:none" href="#">Download</a>
  <script>
    const apiInput = document.getElementById('api_key_input');
    apiInput.value = localStorage.getItem('api_key') || '';
    apiInput.addEventListener('change', () => {
      localStorage.setItem('api_key', apiInput.value);
    });

    async function generate(){
      const prompt = document.getElementById('prompt').value;
      const apiKey = apiInput.value.trim();
      localStorage.setItem('api_key', apiKey);
      const res = await fetch('/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt, api_key: apiKey })
      });
      const data = await res.json();
      if(!res.ok){
        document.getElementById('message').textContent = data.error;
        return;
      }
      document.getElementById('message').textContent = data.remaining === null ? 'Premium user' : `Remaining free uses: ${data.remaining}`;
      document.getElementById('preview').innerHTML = `<img src="data:image/png;base64,${data.preview}" />`;
      const download = document.getElementById('download');
      download.href = '/download/' + data.font_id;
      download.style.display = 'inline';
    }
    document.getElementById('generate').addEventListener('click', generate);
  </script>
</body>
</html>
